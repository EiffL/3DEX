<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>3DEX: /Users/silver/Dropbox/3DEX/src/f90/mod/f3dex_cosmotools.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">3DEX&#160;<span id="projectnumber">1.0</span></div>
   <div id="projectbrief">Three-dimensional Fourier-Bessel decomposition</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<div class="title">/Users/silver/Dropbox/3DEX/src/f90/mod/f3dex_cosmotools.f90</div>  </div>
</div>
<div class="contents">
<a href="f3dex__cosmotools_8f90.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacef3dex__cosmotools.html">00001</a> <span class="keyword">MODULE</span> f3dex_cosmotools
<a name="l00002"></a>00002 
<a name="l00003"></a>00003   USE <span class="keywordflow">f3dex_utils</span>
<a name="l00004"></a>00004   USE <span class="keywordflow">f3dex_stats</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006   USE <span class="keywordflow">healpix_types</span>
<a name="l00007"></a>00007   USE <span class="keywordflow">healpix_modules</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009   <span class="keyword">IMPLICIT NONE</span>
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="namespacef3dex__cosmotools.html#a211d492263b2040371280021352d9154">00011</a>   <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">PARAMETER</span> :: c = 299792458_dp   <span class="comment">! Speed of light</span>
<a name="l00012"></a><a class="code" href="namespacef3dex__cosmotools.html#a8953fe6dc399fcf889789bee9702ee65">00012</a>   <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">PARAMETER</span> :: tcmb = 2726000_dp  <span class="comment">! CMB temperature [micro Kelvin]</span>
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="typef3dex__cosmotools_1_1recognized_params.html">00014</a>   <span class="keyword">TYPE</span> <a class="code" href="typef3dex__cosmotools_1_1recognized_params.html">recognizedParams</a>
<a name="l00015"></a><a class="code" href="typef3dex__cosmotools_1_1recognized_params.html#a7efee7086908340e3aa2bd28ce5b9005">00015</a>      <span class="keywordtype">character(len=FILENAMELEN)</span> :: surveyfile, almnoutfile, clnoutfile
<a name="l00016"></a><a class="code" href="typef3dex__cosmotools_1_1recognized_params.html#a09746178e4eccb40629aec42894f2ba6">00016</a>      <span class="keywordtype">INTEGER(I4B)</span> :: nbcolsinfile, inradian, sorted, nside, nblayers, multiscale
<a name="l00017"></a><a class="code" href="typef3dex__cosmotools_1_1recognized_params.html#a3e31572d077d164d5b2b6c62a772a6ba">00017</a>      <span class="keywordtype">REAL(DP)</span> :: theta_cut_deg, convfc, h, omega_l, omega_m, omega_b, wa, w0
<a name="l00018"></a><a class="code" href="typef3dex__cosmotools_1_1recognized_params.html#a294186863347b6b31dba6e5d547967cb">00018</a>      <span class="keywordtype">REAL(DP)</span> :: rmaxinput
<a name="l00019"></a><a class="code" href="typef3dex__cosmotools_1_1recognized_params.html#ab7d187abd89f3a1ef4be507a966803ae">00019</a>      <span class="keywordtype">INTEGER(I4B)</span> :: nnmax, nlmax, nmmax,iter_order, nbptsasked
<a name="l00020"></a><a class="code" href="typef3dex__cosmotools_1_1recognized_params.html#a3d160c10b254a3978520c26f72be8bf2">00020</a>      <span class="keywordtype">INTEGER(I4B)</span>, <span class="keywordtype">DIMENSION(1:3)</span> :: iwhere
<a name="l00021"></a>00021 <span class="keyword">  END TYPE recognizedParams</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="keyword">CONTAINS</span>  
<a name="l00024"></a>00024 
<a name="l00025"></a>00025   <span class="comment">! ---------------------------------------------------------------------------------------!    </span>
<a name="l00026"></a>00026 
<a name="l00030"></a><a class="code" href="namespacef3dex__cosmotools.html#abeb005e8bef92ebc0927b69db637906d">00030</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#abeb005e8bef92ebc0927b69db637906d">equatorial2galactic_deg</a>( delta, alpha, b, l )
<a name="l00031"></a>00031 
<a name="l00032"></a>00032     <span class="keywordtype">REAL(DP)</span> :: delta, alpha, b, l
<a name="l00033"></a>00033 
<a name="l00034"></a>00034     b = asin( sin(delta)*cos(62.6) - cos(delta)*sin(alpha-282.25)*sin(62.6) )
<a name="l00035"></a>00035     l = 33 + atan( (sin(delta)*sin(62.6)+cos(delta)*sin(alpha-282.25)*cos(62.6)) / &amp;
<a name="l00036"></a>00036          &amp; (cos(delta)*cos(alpha-282.25)))
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="keyword">  END SUBROUTINE equatorial2galactic_deg</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040   <span class="comment">! ---------------------------------------------------------------------------------------!    </span>
<a name="l00041"></a>00041 
<a name="l00044"></a><a class="code" href="namespacef3dex__cosmotools.html#a0caf479bc891741c90e36f878444e333">00044</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#a0caf479bc891741c90e36f878444e333">inquireAndDelete</a>( filename )
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="keywordtype">CHARACTER(len=FILENAMELEN)</span> :: filename, cmd
<a name="l00047"></a>00047     <span class="keywordtype">LOGICAL</span> :: filefound
<a name="l00048"></a>00048 
<a name="l00049"></a>00049     <span class="keyword">INQUIRE</span>(file=filename, exist=filefound)
<a name="l00050"></a>00050     <span class="keyword">IF</span>(filefound) <span class="keyword">THEN</span>
<a name="l00051"></a>00051        <span class="keyword">WRITE</span>(cmd, <span class="stringliteral">&#39;(&quot;rm &quot;, A)&#39;</span> ) trim(filename)
<a name="l00052"></a>00052        CALL system(cmd)
<a name="l00053"></a>00053        PRINT*,<span class="stringliteral">&quot;&gt; Found and deleted: &quot;</span>,trim(filename)
<a name="l00054"></a>00054     <span class="keyword">ENDIF</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="keyword">  END SUBROUTINE inquireAndDelete</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058   <span class="comment">! ---------------------------------------------------------------------------------------!    </span>
<a name="l00059"></a>00059 
<a name="l00065"></a><a class="code" href="namespacef3dex__cosmotools.html#a36578d36cffe32d26a9fd914d032ef3a">00065</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#a36578d36cffe32d26a9fd914d032ef3a">read_survey</a>(file, nbptsmax, nbcolsinfile, nbpts, surveytemp)
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="keywordtype">CHARACTER(len=FILENAMELEN)</span> :: file
<a name="l00068"></a>00068     <span class="keywordtype">INTEGER(I4B)</span> :: rdstatus, status, nbptsmax, nbpts, nbcolsinfile, nbcols, i, k
<a name="l00069"></a>00069     <span class="keywordtype">CHARACTER(len=*)</span>, <span class="keywordtype">PARAMETER</span>   :: code = <span class="stringliteral">&quot;read_survey&quot;</span>
<a name="l00070"></a>00070     <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">DIMENSION(1:nbptsmax, 1:nbcolsinfile)</span> :: surveytemp
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     nbpts = 0
<a name="l00073"></a>00073     <span class="keyword">OPEN</span>(2,file=file,iostat=rdstatus)
<a name="l00074"></a>00074     
<a name="l00075"></a>00075     <span class="keyword">DO</span> <span class="keyword">WHILE</span>( nbpts &lt; nbptsmax .AND. rdstatus == 0  )  
<a name="l00076"></a>00076        <span class="keyword">DO</span> i=1,nbptsmax
<a name="l00077"></a>00077           nbpts = i-1
<a name="l00078"></a>00078           <span class="keyword">READ</span>(2,*,iostat = rdstatus,END=61) (surveytemp(i,k),k=1,nbcolsinfile) 
<a name="l00079"></a>00079           nbpts = i
<a name="l00080"></a>00080        <span class="keyword">ENDDO</span>
<a name="l00081"></a>00081     <span class="keyword">ENDDO</span>
<a name="l00082"></a>00082 61  CONTINUE
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keyword">  END SUBROUTINE read_survey</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086   <span class="comment">! ---------------------------------------------------------------------------------------!    </span>
<a name="l00087"></a>00087 
<a name="l00092"></a><a class="code" href="namespacef3dex__cosmotools.html#a25e2703c39b2d99c864537823f2f8402">00092</a>   <span class="keyword">REAL(DP) </span><span class="keyword">FUNCTION </span><a class="code" href="namespacef3dex__cosmotools.html#a25e2703c39b2d99c864537823f2f8402">int_NC</a>(x, f, n)
<a name="l00093"></a>00093     <span class="comment">! Newton-Cotes integration, for f(x) unIFormly discretized</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">DIMENSION(1:n)</span> :: x, f, weights
<a name="l00096"></a>00096     <span class="keywordtype">INTEGER(I4B)</span> :: n
<a name="l00097"></a>00097     <span class="keywordtype">REAL(DP)</span> :: integral
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="comment">! Uses Newton-Cotes integration</span>
<a name="l00100"></a>00100     <span class="comment">! From the QUADRULE package</span>
<a name="l00101"></a>00101 
<a name="l00102"></a>00102     CALL <a class="code" href="quadrule_8f90.html#a0b336aacd3856d5d5e724522dd3e6e8a">nc_com</a>( 5, x(1), x(n), x, weights )
<a name="l00103"></a>00103 
<a name="l00104"></a>00104     <a class="code" href="namespacef3dex__cosmotools.html#a25e2703c39b2d99c864537823f2f8402">int_NC</a> = sum( weights*f )
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     RETURN
<a name="l00107"></a>00107 <span class="keyword">  END FUNCTION int_NC</span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   <span class="comment">! ---------------------------------------------------------------------------------------!    </span>
<a name="l00110"></a>00110 
<a name="l00116"></a><a class="code" href="namespacef3dex__cosmotools.html#a78ae43d2bd5f180e65c710dc694bcee4">00116</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#a78ae43d2bd5f180e65c710dc694bcee4">cosmo_z2s</a>( h_in, omega_m_in, omega_l_in, omega_b_in, wa_in, w0_in, z, nbpts_in, sk )   ! need in cosmo : h, omega_b, omega_m, omega_l
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="keywordtype">INTEGER(I4B)</span> :: nbpts_in, nbpts,i
<a name="l00119"></a>00119     <span class="keywordtype">REAL(DP)</span> :: h, omega_m, omega_l, omega_b, omega_k, wa, w0, sqrtk
<a name="l00120"></a>00120     <span class="keywordtype">REAL(DP)</span> :: h_in, omega_m_in, omega_l_in, omega_b_in, wa_in, w0_in
<a name="l00121"></a>00121     COMMON h, omega_m, omega_l, omega_b, omega_k, wa, w0, sqrtk, nbpts
<a name="l00122"></a>00122 
<a name="l00123"></a>00123     <span class="keywordtype">REAL(DP)</span> :: omega_dm, omega, gamma, h0, rh, k, r0
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">DIMENSION(1:nbpts_in)</span> :: z, chi, sk
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     h = h_in
<a name="l00128"></a>00128     omega_m = omega_m_in
<a name="l00129"></a>00129     omega_l = omega_l_in
<a name="l00130"></a>00130     omega_b = omega_b_in
<a name="l00131"></a>00131     wa = wa_in
<a name="l00132"></a>00132     w0 = w0_in
<a name="l00133"></a>00133     nbpts = nbpts_in
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     h0 = 100.0_dp * h
<a name="l00136"></a>00136     rh = c/(1000*h0)
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     omega_dm = omega_m - omega_b  <span class="comment">! Dark matter density</span>
<a name="l00139"></a>00139     omega = omega_m + omega_l       <span class="comment">! Total density</span>
<a name="l00140"></a>00140     omega_k = 1.0_dp - omega             <span class="comment">! Curvature</span>
<a name="l00141"></a>00141     gamma = omega_m * h * &amp;    <span class="comment">! Sugiyama (1995, APJS, 100, 281)</span>
<a name="l00142"></a>00142          &amp; exp(-omega_b*(1.0_dp + sqrt(2.0_dp*h)/omega_m)) 
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keyword">IF</span>( omega &gt; 1.001 ) <span class="keyword">THEN</span>    <span class="comment">! closed</span>
<a name="l00145"></a>00145        k = 1.0_dp                         
<a name="l00146"></a>00146        sqrtk = sqrt(omega-1.0_dp)    <span class="comment">! useful factor</span>
<a name="l00147"></a>00147     <span class="keyword">ENDIF</span>                          <span class="comment">! with  a=r/r0</span>
<a name="l00148"></a>00148     <span class="keyword">IF</span>( omega &gt; 0.999 .and. omega &lt; 1.001 ) <span class="keyword">THEN</span>
<a name="l00149"></a>00149        k = 0.0_dp                     <span class="comment">! flat</span>
<a name="l00150"></a>00150        sqrtk = 1.0_dp
<a name="l00151"></a>00151     <span class="keyword">ENDIF</span>
<a name="l00152"></a>00152     <span class="keyword">IF</span>( omega &lt; 0.999 ) <span class="keyword">THEN</span>         <span class="comment">! open</span>
<a name="l00153"></a>00153        k = -1.0_dp  
<a name="l00154"></a>00154        sqrtk = sqrt(1.0_dp - omega)       
<a name="l00155"></a>00155     <span class="keyword">ENDIF</span>
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     r0 = rh / sqrtk  
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     <span class="comment">! comoving distance in units of R_0  [1] </span>
<a name="l00160"></a>00160     PRINT*,<span class="stringliteral">&quot;Computing chi...&quot;</span>
<a name="l00161"></a>00161     <span class="comment">!CALL chi_z1(z,chi)</span>
<a name="l00162"></a>00162     <span class="keyword">DO</span> i=1, nbpts
<a name="l00163"></a>00163        CALL <a class="code" href="namespacef3dex__cosmotools.html#abdbb37c7c522bf29ebf089412b9d7854">chi_z0</a>(z(i),chi(i))
<a name="l00164"></a>00164     <span class="keyword">ENDDO</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">! sk(chi): radial comoving distance in units of R_0  [1],</span>
<a name="l00167"></a>00167     <span class="keyword">IF</span>( omega &gt; 1.001 ) <span class="keyword">THEN</span> 
<a name="l00168"></a>00168        sk = chi
<a name="l00169"></a>00169     <span class="keyword">ENDIF</span>
<a name="l00170"></a>00170     <span class="keyword">IF</span>( omega &gt; 0.999 .and. omega &lt; 1.001 ) <span class="keyword">THEN</span> 
<a name="l00171"></a>00171        sk = sin(chi)
<a name="l00172"></a>00172     <span class="keyword">ENDIF</span>
<a name="l00173"></a>00173     <span class="keyword">IF</span>( omega &lt; 0.999 ) <span class="keyword">THEN</span> 
<a name="l00174"></a>00174        sk = sinh(chi)
<a name="l00175"></a>00175     <span class="keyword">ENDIF</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177     sk = abs(sk) * r0
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     RETURN
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="keyword">  END SUBROUTINE cosmo_z2s</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">! ---------------------------------------------------------------------------------------!</span>
<a name="l00185"></a>00185 
<a name="l00189"></a><a class="code" href="namespacef3dex__cosmotools.html#abdbb37c7c522bf29ebf089412b9d7854">00189</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#abdbb37c7c522bf29ebf089412b9d7854">chi_z0</a>(zin, chi)
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="keywordtype">REAL(DP)</span> :: zin, chi
<a name="l00192"></a>00192     <span class="keywordtype">REAL</span>, <span class="keywordtype">parameter</span> :: a = 0.0E+00
<a name="l00193"></a>00193     <span class="keywordtype">REAL</span> :: abserr, b
<a name="l00194"></a>00194     <span class="keywordtype">REAL</span>, <span class="keywordtype">parameter</span> :: epsabs = 0.001E+00
<a name="l00195"></a>00195     <span class="keywordtype">REAL</span>, <span class="keywordtype">parameter</span> :: epsrel = 0.001E+00
<a name="l00196"></a>00196     <span class="keywordtype">INTEGER</span> :: ier
<a name="l00197"></a>00197     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">parameter</span> :: key = 6
<a name="l00198"></a>00198     <span class="keywordtype">INTEGER</span> :: neval, nb, i
<a name="l00199"></a>00199     <span class="keywordtype">REAL</span>, <span class="keywordtype">dimension(1:30)</span> :: points
<a name="l00200"></a>00200     <span class="keywordtype">REAL</span> :: res
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     b = <span class="keywordtype">REAL</span>(zin)
<a name="l00203"></a>00203     nb = 30
<a name="l00204"></a>00204     <span class="keyword">DO</span> i=1,nb
<a name="l00205"></a>00205        points(i) = i*b/30
<a name="l00206"></a>00206     <span class="keyword">ENDDO</span>
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     CALL <a class="code" href="quadpack_8f90.html#a99cf2a02a14029fad4762555f04cac0e">qagp </a>( <a class="code" href="namespacef3dex__cosmotools.html#abba0e9b02d0f46a5abce5a0830da7f4d">fz</a>, a, b, nb, points, epsabs, epsrel, res, abserr, neval, ier )
<a name="l00209"></a>00209     chi = res
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 <span class="keyword">  END SUBROUTINE chi_z0</span>
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   <span class="comment">! ---------------------------------------------------------------------------------------!</span>
<a name="l00214"></a>00214 
<a name="l00218"></a><a class="code" href="namespacef3dex__cosmotools.html#aae4fa92003adf2bfde48fa0dfcbf6b51">00218</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#aae4fa92003adf2bfde48fa0dfcbf6b51">chi_z1</a>(zin, chi)
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordtype">INTEGER(I4B)</span> :: nbpts
<a name="l00221"></a>00221     <span class="keywordtype">REAL(DP)</span> :: h, omega_m, omega_l, omega_b, omega_k, wa, w0, sqrtk
<a name="l00222"></a>00222     COMMON h, omega_m, omega_l, omega_b, omega_k, wa, w0, sqrtk, nbpts
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordtype">INTEGER(I4B)</span> :: i, k, nb
<a name="l00225"></a>00225     <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">DIMENSION(1:nbpts)</span> :: zin,chi
<a name="l00226"></a>00226     <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">DIMENSION(1:20)</span> :: bpoints
<a name="l00227"></a>00227     <span class="keywordtype">REAL</span>, <span class="keywordtype">parameter</span> :: a = 0.0E+00
<a name="l00228"></a>00228     <span class="keywordtype">REAL</span> :: abserr, b0, b1, res
<a name="l00229"></a>00229     <span class="keywordtype">REAL</span>, <span class="keywordtype">parameter</span> :: epsabs = 0.001E+00
<a name="l00230"></a>00230     <span class="keywordtype">REAL</span>, <span class="keywordtype">parameter</span> :: epsrel = 0.001E+00
<a name="l00231"></a>00231     <span class="keywordtype">INTEGER</span> :: ier, neval
<a name="l00232"></a>00232     <span class="keywordtype">INTEGER</span>, <span class="keywordtype">parameter</span> :: key = 6
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     nb = 20
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="keyword">DO</span> i = 1, nbpts
<a name="l00237"></a>00237 
<a name="l00238"></a>00238        b0 = <span class="keywordtype">REAL(zin(i-1))</span> <span class="comment">!REAL(INT(zin(i-1) * 10000.0 + 0.5))  / 10000.0</span>
<a name="l00239"></a>00239        b1 = <span class="keywordtype">REAL(zin(i))</span> <span class="comment">!REAL(INT(zin(i) * 10000.0 + 0.5))  / 10000.0</span>
<a name="l00240"></a>00240        res = 0.0
<a name="l00241"></a>00241 
<a name="l00242"></a>00242        <span class="keyword">IF</span>( b1 &gt; b0 ) <span class="keyword">THEN</span>
<a name="l00243"></a>00243           CALL <a class="code" href="quadpack_8f90.html#a44906a25a31588f7e4f41f0e5253193a">qag </a>( <a class="code" href="namespacef3dex__cosmotools.html#abba0e9b02d0f46a5abce5a0830da7f4d">fz</a>, b0, b1, epsabs, epsrel, key, res, abserr, neval, ier )
<a name="l00244"></a>00244           chi(i) = chi(i-1) + res
<a name="l00245"></a>00245        <span class="keyword">ELSE</span>
<a name="l00246"></a>00246           CALL <a class="code" href="quadpack_8f90.html#a44906a25a31588f7e4f41f0e5253193a">qag </a>( <a class="code" href="namespacef3dex__cosmotools.html#abba0e9b02d0f46a5abce5a0830da7f4d">fz</a>, a, b1, epsabs, epsrel, key, res, abserr, neval, ier )
<a name="l00247"></a>00247           chi(i) = res
<a name="l00248"></a>00248        <span class="keyword">ENDIF</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250        <span class="keyword">IF</span>( isnan(res) ) <span class="keyword">THEN</span>
<a name="l00251"></a>00251           <span class="keyword">DO</span> k=1, 20
<a name="l00252"></a>00252              bpoints(k) = k*b1/20
<a name="l00253"></a>00253           <span class="keyword">ENDDO</span>
<a name="l00254"></a>00254           CALL <a class="code" href="quadpack_8f90.html#a99cf2a02a14029fad4762555f04cac0e">qagp </a>( <a class="code" href="namespacef3dex__cosmotools.html#abba0e9b02d0f46a5abce5a0830da7f4d">fz</a>, a, b1, nb, bpoints, epsabs, epsrel, res, abserr, neval, ier )
<a name="l00255"></a>00255        <span class="keyword">ENDIF</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="keyword">ENDDO</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="keyword">  END SUBROUTINE chi_z1</span>
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="comment">! ---------------------------------------------------------------------------------------!</span>
<a name="l00262"></a>00262 
<a name="l00266"></a><a class="code" href="namespacef3dex__cosmotools.html#a6c29a874ae95da9fb207a2f63729eecf">00266</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#a6c29a874ae95da9fb207a2f63729eecf">chi_z2</a>(zin, chi)
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     <span class="keywordtype">INTEGER(I4B)</span> :: nbpts
<a name="l00269"></a>00269     <span class="keywordtype">REAL(DP)</span> :: h, omega_m, omega_l, omega_b, omega_k, wa, w0, sqrtk
<a name="l00270"></a>00270     COMMON h, omega_m, omega_l, omega_b, omega_k, wa, w0, sqrtk, nbpts
<a name="l00271"></a>00271 
<a name="l00272"></a>00272     <span class="keywordtype">INTEGER(I4B)</span> :: i,j, norder, nsub
<a name="l00273"></a>00273     <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">DIMENSION(1:nbpts)</span> :: zin, chi
<a name="l00274"></a>00274     <span class="keywordtype">REAL(DP)</span>, <span class="keywordtype">DIMENSION(1:50)</span> :: weights, xtab
<a name="l00275"></a>00275     <span class="keywordtype">DOuble precision</span> a, b, xlo, xhi, res
<a name="l00276"></a>00276 
<a name="l00277"></a>00277     a = 0.0D+00
<a name="l00278"></a>00278 
<a name="l00279"></a>00279     norder = 5
<a name="l00280"></a>00280     nsub = 1
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     xlo = -1.0D+00
<a name="l00283"></a>00283     xhi = +1.0D+00
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <span class="keyword">DO</span> i = 1, nbpts
<a name="l00286"></a>00286 
<a name="l00287"></a>00287        b = zin(i) <span class="comment">!REAL(INT(zin(i) * 10000.0 + 0.5))   / 10000.0</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289        <span class="comment">!DO j=1,1000</span>
<a name="l00290"></a>00290        <span class="comment">!   xtab(j)=j*b/1000</span>
<a name="l00291"></a>00291        <span class="comment">!ENDDO</span>
<a name="l00292"></a>00292 
<a name="l00293"></a>00293        CALL <a class="code" href="quadrule_8f90.html#a45c034914a08b905c6dbe38d8ef5c5d9">ncc_set </a>( norder, xtab, weights )
<a name="l00294"></a>00294 
<a name="l00295"></a>00295        CALL <a class="code" href="quadrule_8f90.html#a268ec8eaa9ed225402666340aecb03d4">sum_sub</a>( <a class="code" href="namespacef3dex__cosmotools.html#abba0e9b02d0f46a5abce5a0830da7f4d">fz</a>, a, b, nsub, norder, xlo, xhi, xtab, weights, res )
<a name="l00296"></a>00296 
<a name="l00297"></a>00297        chi(i) = res
<a name="l00298"></a>00298        PRINT*,b,chi(i)
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="keyword">ENDDO</span>
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 <span class="keyword">  END SUBROUTINE chi_z2</span>
<a name="l00303"></a>00303 
<a name="l00304"></a>00304   <span class="comment">! ---------------------------------------------------------------------------------------!</span>
<a name="l00305"></a>00305 
<a name="l00308"></a><a class="code" href="namespacef3dex__cosmotools.html#abba0e9b02d0f46a5abce5a0830da7f4d">00308</a>   <span class="keyword">REAL </span><span class="keyword">FUNCTION </span><a class="code" href="namespacef3dex__cosmotools.html#abba0e9b02d0f46a5abce5a0830da7f4d">fz</a>(z)
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="keywordtype">INTEGER(I4B)</span> :: nbpts
<a name="l00311"></a>00311     <span class="keywordtype">REAL(DP)</span> :: h, omega_m, omega_l, omega_b, omega_k, wa, w0, sqrtk
<a name="l00312"></a>00312     COMMON h, omega_m, omega_l, omega_b, omega_k, wa, w0, sqrtk, nbpts
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="keywordtype">REAL(DP)</span> :: z
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <a class="code" href="namespacef3dex__cosmotools.html#abba0e9b02d0f46a5abce5a0830da7f4d">fz</a> = ( omega_m*((1+z)**3) + omega_k*((1+z)**2) + omega_l )**(-0.5_dp) 
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     RETURN
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <span class="keyword">  END FUNCTION fz</span>
<a name="l00321"></a>00321 
<a name="l00322"></a>00322   <span class="comment">! ---------------------------------------------------------------------------------------!</span>
<a name="l00323"></a>00323 
<a name="l00327"></a><a class="code" href="namespacef3dex__cosmotools.html#a609d3f29da9fc1be3bf27757e25532eb">00327</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#a609d3f29da9fc1be3bf27757e25532eb">txtfile2parameters</a>(paramfile,params)
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keyword">IMPLICIT NONE</span>
<a name="l00330"></a>00330     <span class="keywordtype">character(len=FILENAMELEN)</span> :: paramfile, description
<a name="l00331"></a>00331     <span class="keywordtype">TYPE(recognizedParams)</span>     :: params
<a name="l00332"></a>00332     <span class="keywordtype">LOGICAL(LGT)</span>            :: fileexists
<a name="l00333"></a>00333     <span class="keywordtype">INTEGER(i4b)</span>            :: nbparam, rdstatus, i, k, status
<a name="l00334"></a>00334     <span class="keywordtype">character(len=12)</span>       :: tmp1
<a name="l00335"></a>00335     <span class="keywordtype">character(len=30)</span>       :: tmp2
<a name="l00336"></a>00336     <span class="keywordtype">character(len=6)</span>         :: name
<a name="l00337"></a>00337     <span class="keywordtype">character(len=30)</span>       :: value
<a name="l00338"></a>00338     <span class="keywordtype">character(len=100)</span>      :: chline,chline1
<a name="l00339"></a>00339     <span class="keywordtype">type(paramfile_handle)</span>      :: handle
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     params%nblayers = 0
<a name="l00343"></a>00343     params%convfc = 1.0
<a name="l00344"></a>00344     params%almnoutfile = <span class="stringliteral">&quot;&quot;</span>
<a name="l00345"></a>00345     params%clnoutfile = <span class="stringliteral">&quot;&quot;</span>
<a name="l00346"></a>00346     params%nbptsasked = -1
<a name="l00347"></a>00347     params%multiscale = -1
<a name="l00348"></a>00348     <span class="comment">!params%nbptsinfile = -1</span>
<a name="l00349"></a>00349     params%surveyfile = <span class="stringliteral">&quot;&quot;</span>
<a name="l00350"></a>00350     params%nbcolsinfile = -1
<a name="l00351"></a>00351     params%inradian = -1
<a name="l00352"></a>00352     params%sorted = -1
<a name="l00353"></a>00353     params%nside = -1
<a name="l00354"></a>00354     params%nnmax = -1
<a name="l00355"></a>00355     params%nlmax = -1
<a name="l00356"></a>00356     params%nmmax = -1
<a name="l00357"></a>00357     params%iter_order = -1
<a name="l00358"></a>00358     <span class="comment">!params%coordsys = &#39;N&#39;</span>
<a name="l00359"></a>00359     params%iwhere = -1
<a name="l00360"></a>00360     params%theta_cut_deg = -1.0
<a name="l00361"></a>00361     params%h = -1
<a name="l00362"></a>00362     params%w0 = -10 
<a name="l00363"></a>00363     params%wa = -10
<a name="l00364"></a>00364     params%omega_l = -1 
<a name="l00365"></a>00365     params%omega_b = -1
<a name="l00366"></a>00366     params%omega_m = -1
<a name="l00367"></a>00367     params%rmaxinput = -1.0_dp
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     PRINT*,<span class="stringliteral">&quot;&quot;</span>
<a name="l00371"></a>00371     PRINT*,<span class="stringliteral">&quot;-----------------------------------&quot;</span>
<a name="l00372"></a>00372     PRINT*,<span class="stringliteral">&quot;Reading parameters&quot;</span>
<a name="l00373"></a>00373     PRINT*,<span class="stringliteral">&quot;-----------------------------------&quot;</span>
<a name="l00374"></a>00374     PRINT*,<span class="stringliteral">&quot;&quot;</span>
<a name="l00375"></a>00375     handle = parse_init(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00376"></a>00376     <span class="keyword">IF</span>( paramfile /= <span class="stringliteral">&quot;&quot;</span> ) <span class="keyword">THEN</span>
<a name="l00377"></a>00377        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00378"></a>00378        PRINT*,<span class="stringliteral">&quot;File to be read : &quot;</span>,paramfile(1:20)
<a name="l00379"></a>00379        <span class="keyword">inquire</span>( file=paramfile, exist=fileexists)
<a name="l00380"></a>00380        <span class="keyword">IF</span>( fileexists ) <span class="keyword">THEN</span>
<a name="l00381"></a>00381           PRINT*,<span class="stringliteral">&quot;Checking file : ok existing.&quot;</span>
<a name="l00382"></a>00382        <span class="keyword">ELSE</span>
<a name="l00383"></a>00383           CALL fatal_error(<span class="stringliteral">&quot;Incorrect input file (parameters)&quot;</span>)
<a name="l00384"></a>00384        <span class="keyword">ENDIF</span>
<a name="l00385"></a>00385        <span class="keyword">open</span>(1,file= paramfile, status=<span class="stringliteral">&#39;old&#39;</span>, iostat=rdstatus)
<a name="l00386"></a>00386        PRINT*,<span class="stringliteral">&quot;Opening file status: &quot;</span>,rdstatus
<a name="l00387"></a>00387        <span class="keyword">DO</span> <span class="keyword">while</span>(rdstatus == 0)  
<a name="l00388"></a>00388           <span class="keyword">read</span>(1,*,iostat = rdstatus) 
<a name="l00389"></a>00389           <span class="keyword">IF</span> (rdstatus == 0) <span class="keyword">THEN</span>
<a name="l00390"></a>00390              nbparam = nbparam + 1
<a name="l00391"></a>00391           <span class="keyword">ENDIF</span>
<a name="l00392"></a>00392        <span class="keyword">END DO</span>
<a name="l00393"></a>00393        PRINT*,<span class="stringliteral">&quot;Number of parameters provided in file : &quot;</span>, nbparam
<a name="l00394"></a>00394        <span class="comment">!</span>
<a name="l00395"></a>00395        rewind(unit=1,iostat=rdstatus)
<a name="l00396"></a>00396        PRINT*,<span class="stringliteral">&quot;Extraction of parameters...&quot;</span>
<a name="l00397"></a>00397        <span class="keyword">DO</span> i=1, nbparam
<a name="l00398"></a>00398           <span class="keyword">READ</span> (1,*,END=51) tmp1, tmp2
<a name="l00399"></a>00399           PRINT*,tmp1,tmp2
<a name="l00400"></a>00400           name = tmp1(1:1)//tmp1(3:3)//tmp1(5:5)&amp;
<a name="l00401"></a>00401                &amp;//tmp1(7:7)//tmp1(9:9)//tmp1(11:11)
<a name="l00402"></a>00402           value = tmp2(1:1)//tmp2(3:3)//tmp2(5:5)&amp;
<a name="l00403"></a>00403                &amp;//tmp2(7:7)//tmp2(9:9)//tmp2(11:11)&amp;
<a name="l00404"></a>00404                &amp;//tmp2(13:13)//tmp2(15:15)//tmp2(17:17)&amp;
<a name="l00405"></a>00405                &amp;//tmp2(19:19)//tmp2(21:21)//tmp2(23:23)&amp;
<a name="l00406"></a>00406                &amp;//tmp2(25:25)//tmp2(27:27)//tmp2(29:29)
<a name="l00407"></a>00407           <span class="comment">!    </span>
<a name="l00408"></a>00408           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;survey&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;SURVEY&quot;</span>) <span class="keyword">THEN</span>
<a name="l00409"></a>00409              params%surveyfile = trim(value)
<a name="l00410"></a>00410              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected :   &quot;</span>, trim(value)
<a name="l00411"></a>00411           <span class="keyword">ENDIF</span>
<a name="l00412"></a>00412           <span class="comment">!    </span>
<a name="l00413"></a>00413           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;almn&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;ALMN&quot;</span>) <span class="keyword">THEN</span>
<a name="l00414"></a>00414              params%almnoutfile = trim(value)
<a name="l00415"></a>00415              PRINT*,<span class="stringliteral">&quot;*   &quot;</span>, trim(name),<span class="stringliteral">&quot; detected :   &quot;</span>, trim(value)
<a name="l00416"></a>00416           <span class="keyword">ENDIF</span>
<a name="l00417"></a>00417           <span class="comment">!    </span>
<a name="l00418"></a>00418           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;cln&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;CLN&quot;</span>) <span class="keyword">THEN</span>
<a name="l00419"></a>00419              params%clnoutfile = trim(value)
<a name="l00420"></a>00420              PRINT*,<span class="stringliteral">&quot;*    &quot;</span>, trim(name),<span class="stringliteral">&quot; detected :   &quot;</span>, trim(value)
<a name="l00421"></a>00421           <span class="keyword">ENDIF</span>
<a name="l00422"></a>00422           <span class="comment">!    </span>
<a name="l00423"></a>00423           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;nbcols&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;NBCOLS&quot;</span>) <span class="keyword">THEN</span>
<a name="l00424"></a>00424              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I2)&#39;</span>) params%nbcolsinfile
<a name="l00425"></a>00425              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%nbcolsinfile
<a name="l00426"></a>00426           <span class="keyword">ENDIF</span>
<a name="l00427"></a>00427           <span class="comment">!    </span>
<a name="l00428"></a>00428           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;nlayrs&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;NLAYRS&quot;</span>) <span class="keyword">THEN</span>
<a name="l00429"></a>00429              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I4)&#39;</span>) params%nblayers
<a name="l00430"></a>00430              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%nblayers
<a name="l00431"></a>00431           <span class="keyword">ENDIF</span>
<a name="l00432"></a>00432           <span class="comment">!    </span>
<a name="l00433"></a>00433           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;phi&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;PHI&quot;</span>) <span class="keyword">THEN</span>
<a name="l00434"></a>00434              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I2)&#39;</span>) params%iwhere(1)
<a name="l00435"></a>00435              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%iwhere(1)
<a name="l00436"></a>00436           <span class="keyword">ENDIF</span>
<a name="l00437"></a>00437           <span class="comment">!    </span>
<a name="l00438"></a>00438           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;theta&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;THETA&quot;</span>) <span class="keyword">THEN</span>
<a name="l00439"></a>00439              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I2)&#39;</span>) params%iwhere(2)
<a name="l00440"></a>00440              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%iwhere(2)
<a name="l00441"></a>00441           <span class="keyword">ENDIF</span>
<a name="l00442"></a>00442           <span class="comment">!    </span>
<a name="l00443"></a>00443           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;z&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;Z&quot;</span>) <span class="keyword">THEN</span>
<a name="l00444"></a>00444              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I2)&#39;</span>) params%iwhere(3)
<a name="l00445"></a>00445              PRINT*,<span class="stringliteral">&quot;*     &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%iwhere(3)
<a name="l00446"></a>00446           <span class="keyword">ENDIF</span>
<a name="l00447"></a>00447           <span class="comment">!    </span>
<a name="l00448"></a>00448           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;radian&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;RADIAN&quot;</span>) <span class="keyword">THEN</span>
<a name="l00449"></a>00449              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I2)&#39;</span>) params%inradian
<a name="l00450"></a>00450              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%inradian 
<a name="l00451"></a>00451           <span class="keyword">ENDIF</span>
<a name="l00452"></a>00452           <span class="comment">!</span>
<a name="l00453"></a>00453           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;sorted&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;SORTED&quot;</span>) <span class="keyword">THEN</span>
<a name="l00454"></a>00454              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I2)&#39;</span>) params%sorted
<a name="l00455"></a>00455              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%sorted  
<a name="l00456"></a>00456           <span class="keyword">ENDIF</span>
<a name="l00457"></a>00457           <span class="comment">!</span>
<a name="l00458"></a>00458           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;equcut&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;EQUCUT&quot;</span>) <span class="keyword">THEN</span>
<a name="l00459"></a>00459              <span class="keyword">IF</span>( trim(value) == <span class="stringliteral">&quot;no&quot;</span> ) <span class="keyword">THEN</span>
<a name="l00460"></a>00460                 params%theta_cut_deg = 0.0
<a name="l00461"></a>00461              <span class="keyword">ELSE</span>
<a name="l00462"></a>00462                 <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F5.3)&#39;</span>) params%theta_cut_deg 
<a name="l00463"></a>00463              <span class="keyword">ENDIF</span>
<a name="l00464"></a>00464              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected :           &quot;</span>, trim(value)  
<a name="l00465"></a>00465           <span class="keyword">ENDIF</span>
<a name="l00466"></a>00466           <span class="comment">!</span>
<a name="l00467"></a>00467           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;nside&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;NSIDE&quot;</span>) <span class="keyword">THEN</span>
<a name="l00468"></a>00468              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I4)&#39;</span>) params%nside
<a name="l00469"></a>00469              PRINT*,<span class="stringliteral">&quot;*  &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%nside 
<a name="l00470"></a>00470           <span class="keyword">ENDIF</span>
<a name="l00471"></a>00471           <span class="comment">!</span>
<a name="l00472"></a>00472           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;h&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;H&quot;</span>) <span class="keyword">THEN</span>
<a name="l00473"></a>00473              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F5.3)&#39;</span>) params%h
<a name="l00474"></a>00474              PRINT*,<span class="stringliteral">&quot;*      &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%h 
<a name="l00475"></a>00475           <span class="keyword">ENDIF</span>
<a name="l00476"></a>00476           <span class="comment">!</span>
<a name="l00477"></a>00477           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;omg_l&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;OMG_L&quot;</span>) <span class="keyword">THEN</span>
<a name="l00478"></a>00478              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F5.3)&#39;</span>) params%omega_l
<a name="l00479"></a>00479              PRINT*,<span class="stringliteral">&quot;*  &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%omega_l 
<a name="l00480"></a>00480           <span class="keyword">ENDIF</span>
<a name="l00481"></a>00481           <span class="comment">!</span>
<a name="l00482"></a>00482           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;omg_m&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;OMG_M&quot;</span>) <span class="keyword">THEN</span>
<a name="l00483"></a>00483              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F10.3)&#39;</span>) params%omega_m
<a name="l00484"></a>00484              PRINT*,<span class="stringliteral">&quot;*  &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%omega_m 
<a name="l00485"></a>00485           <span class="keyword">ENDIF</span>
<a name="l00486"></a>00486           <span class="comment">!</span>
<a name="l00487"></a>00487           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;omg_b&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;OMG_B&quot;</span>) <span class="keyword">THEN</span>
<a name="l00488"></a>00488              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F5.3)&#39;</span>) params%omega_b
<a name="l00489"></a>00489              PRINT*,<span class="stringliteral">&quot;*  &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%omega_b 
<a name="l00490"></a>00490           <span class="keyword">ENDIF</span>
<a name="l00491"></a>00491           <span class="comment">!</span>
<a name="l00492"></a>00492           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;wa&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;WA&quot;</span>) <span class="keyword">THEN</span>
<a name="l00493"></a>00493              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F5.3)&#39;</span>) params%wa
<a name="l00494"></a>00494              PRINT*,<span class="stringliteral">&quot;*     &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%wa 
<a name="l00495"></a>00495           <span class="keyword">ENDIF</span>
<a name="l00496"></a>00496           <span class="comment">!</span>
<a name="l00497"></a>00497           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;convfc&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;CONVFC&quot;</span>) <span class="keyword">THEN</span>
<a name="l00498"></a>00498              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F11.4)&#39;</span>) params%convfc
<a name="l00499"></a>00499              PRINT*,<span class="stringliteral">&quot;*   &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%convfc 
<a name="l00500"></a>00500           <span class="keyword">ENDIF</span>
<a name="l00501"></a>00501           <span class="comment">!</span>
<a name="l00502"></a>00502           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;w0&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;W0&quot;</span>) <span class="keyword">THEN</span>
<a name="l00503"></a>00503              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F5.3)&#39;</span>) params%w0
<a name="l00504"></a>00504              PRINT*,<span class="stringliteral">&quot;*     &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%w0 
<a name="l00505"></a>00505           <span class="keyword">ENDIF</span>
<a name="l00506"></a>00506           <span class="comment">!</span>
<a name="l00507"></a>00507           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;nmax&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;NMAX&quot;</span>) <span class="keyword">THEN</span>
<a name="l00508"></a>00508              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I4)&#39;</span>) params%nnmax
<a name="l00509"></a>00509              PRINT*,<span class="stringliteral">&quot;*   &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%nnmax 
<a name="l00510"></a>00510           <span class="keyword">ENDIF</span>
<a name="l00511"></a>00511           <span class="comment">!</span>
<a name="l00512"></a>00512           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;lmax&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;LMAX&quot;</span>) <span class="keyword">THEN</span>
<a name="l00513"></a>00513              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I4)&#39;</span>) params%nlmax
<a name="l00514"></a>00514              PRINT*,<span class="stringliteral">&quot;*   &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%nlmax   
<a name="l00515"></a>00515           <span class="keyword">ENDIF</span>
<a name="l00516"></a>00516           <span class="comment">!</span>
<a name="l00517"></a>00517           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;mmax&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;MMAX&quot;</span>) <span class="keyword">THEN</span>
<a name="l00518"></a>00518              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I4)&#39;</span>) params%nmmax
<a name="l00519"></a>00519              PRINT*,<span class="stringliteral">&quot;*   &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%nmmax   
<a name="l00520"></a>00520           <span class="keyword">ENDIF</span>
<a name="l00521"></a>00521           <span class="comment">!</span>
<a name="l00522"></a>00522           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;itrord&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;ITRORD&quot;</span>) <span class="keyword">THEN</span>
<a name="l00523"></a>00523              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I2)&#39;</span>)  params%iter_order
<a name="l00524"></a>00524              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%iter_order
<a name="l00525"></a>00525           <span class="keyword">ENDIF</span>
<a name="l00526"></a>00526           <span class="comment">!</span>
<a name="l00527"></a>00527           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;multsc&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;MULTSC&quot;</span>) <span class="keyword">THEN</span>
<a name="l00528"></a>00528              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I4)&#39;</span>)  params%multiscale
<a name="l00529"></a>00529              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%multiscale
<a name="l00530"></a>00530           <span class="keyword">ENDIF</span>
<a name="l00531"></a>00531           <span class="comment">!</span>
<a name="l00532"></a>00532           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;nbrpts&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;NBRPTS&quot;</span>) <span class="keyword">THEN</span>
<a name="l00533"></a>00533              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(I7)&#39;</span>)  params%nbptsasked
<a name="l00534"></a>00534              PRINT*,<span class="stringliteral">&quot;* &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%nbptsasked
<a name="l00535"></a>00535           <span class="keyword">ENDIF</span>
<a name="l00536"></a>00536           <span class="comment">!</span>
<a name="l00537"></a>00537           <span class="keyword">IF</span>(trim(name)==<span class="stringliteral">&quot;rmax&quot;</span>.or.trim(name)==<span class="stringliteral">&quot;RMAX&quot;</span>) <span class="keyword">THEN</span>
<a name="l00538"></a>00538              <span class="keyword">read</span>(value,<span class="stringliteral">&#39;(F11.4)&#39;</span>)  params%rmaxinput
<a name="l00539"></a>00539              PRINT*,<span class="stringliteral">&quot;*   &quot;</span>, trim(name),<span class="stringliteral">&quot; detected : &quot;</span>, params%rmaxinput
<a name="l00540"></a>00540           <span class="keyword">ENDIF</span>
<a name="l00541"></a>00541           <span class="comment">!</span>
<a name="l00542"></a>00542        <span class="keyword">ENDDO</span>
<a name="l00543"></a>00543        PRINT*,<span class="stringliteral">&quot;-- DOne.&quot;</span>
<a name="l00544"></a>00544        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00545"></a>00545 51     continue
<a name="l00546"></a>00546        <span class="keyword">close</span>(1)
<a name="l00547"></a>00547     <span class="keyword">ELSE</span>
<a name="l00548"></a>00548        description = concatnl(<span class="stringliteral">&quot;Enter input file (galaxy survey) name (eg: data.out) : &quot;</span>)
<a name="l00549"></a>00549        params%surveyfile = parse_string(handle, <span class="stringliteral">&#39;surveyfile&#39;</span>, default=<span class="stringliteral">&#39;&#39;</span>, descr=description)
<a name="l00550"></a>00550        <span class="keyword">inquire</span>( file=params%surveyfile, exist=fileexists)
<a name="l00551"></a>00551        <span class="keyword">IF</span>( fileexists .eqv. .FALSE. ) CALL fatal_error(<span class="stringliteral">&quot;This file DOesn&#39;t exist!&quot;</span>)
<a name="l00552"></a>00552        <span class="keyword">IF</span> (trim(params%surveyfile)==<span class="stringliteral">&#39;&#39;</span>) CALL fatal_error(<span class="stringliteral">&#39;Error : no input file provided&#39;</span>)    
<a name="l00553"></a>00553        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00554"></a>00554        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00555"></a>00555     <span class="keyword">ENDIF</span>
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="keyword">  END SUBROUTINE txtfile2parameters</span>
<a name="l00559"></a>00559 
<a name="l00560"></a>00560   <span class="comment">! ---------------------------------------------------------------------------------------!    </span>
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 
<a name="l00564"></a><a class="code" href="namespacef3dex__cosmotools.html#a8405dbd12e86a408520f40f1b0a68919">00564</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#a8405dbd12e86a408520f40f1b0a68919">getParameters_survey2almn</a>(multiscale, zbounds, nr, nside, nnmax, nlmax, nmmax, iter_order, &amp;
<a name="l00565"></a>00565        &amp; nbpts, iwhere, inradian, sorted, convfc, nbcolsinfile, surveyfile, paramfile, &amp;
<a name="l00566"></a>00566        &amp; almnoutfile, clnoutfile, h, w0, wa, omega_l, omega_b, omega_m, rmaxinput )
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     <span class="comment">! ------------------------------------------------------------------------------</span>
<a name="l00569"></a>00569     <span class="comment">! Get all the parameters of the method</span>
<a name="l00570"></a>00570     <span class="comment">! ------------------------------------------------------------------------------</span>
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="keyword">IMPLICIT NONE</span>
<a name="l00573"></a>00573 
<a name="l00574"></a>00574     <span class="keywordtype">INTEGER(i4b)</span>       :: nbparam, rdstatus, i, k, status
<a name="l00575"></a>00575     <span class="keywordtype">LOGICAL(LGT)</span>       :: fileexists
<a name="l00576"></a>00576     <span class="keywordtype">character(len=12)</span>  :: tmp1
<a name="l00577"></a>00577     <span class="keywordtype">character(len=30)</span>  :: tmp2
<a name="l00578"></a>00578     <span class="keywordtype">character(len=6)</span>   :: name
<a name="l00579"></a>00579     <span class="keywordtype">character(len=30)</span>  :: value
<a name="l00580"></a>00580     <span class="keywordtype">character(len=100)</span> :: chline,chline1
<a name="l00581"></a>00581     <span class="keywordtype">TYPE(recognizedParams)</span>   :: params
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 
<a name="l00584"></a>00584     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">PARAMETER</span>        :: code = <span class="stringliteral">&quot;Parameters extraction&quot;</span>
<a name="l00585"></a>00585     <span class="keywordtype">character(len=FILENAMELEN)</span>         :: paramfile
<a name="l00586"></a>00586     <span class="keywordtype">type(paramfile_handle)</span>          :: handle
<a name="l00587"></a>00587     <span class="keywordtype">character(len=FILENAMELEN)</span>         :: surveyfile, description, almnoutfile, clnoutfile
<a name="l00588"></a>00588     <span class="keywordtype">INTEGER(i4b)</span>             :: nbptsasked, nbptsinfile, nbcolsinfile
<a name="l00589"></a>00589     <span class="keywordtype">INTEGER(i4b)</span>               :: inradian, sorted, iter_order, nbpts, nr
<a name="l00590"></a>00590     <span class="keywordtype">INTEGER(i4b)</span>                :: nside, nnmax, nlmax, nmmax, multiscale
<a name="l00591"></a>00591     <span class="keywordtype">character</span>                  :: coordsys
<a name="l00592"></a>00592     <span class="keywordtype">INTEGER(kind=i4b)</span>, <span class="keywordtype">DIMENSION(1:3)</span>  :: iwhere
<a name="l00593"></a>00593     <span class="keywordtype">REAL</span>(kind=DP)              :: theta_cut_deg, cos_theta_cut, fsky, convfc
<a name="l00594"></a>00594     <span class="keywordtype">REAL</span>(kind=DP)      :: rmaxinput, h, w0, wa, omega_l, omega_b, omega_m
<a name="l00595"></a>00595     <span class="keywordtype">REAL(kind=DP)</span>,     <span class="keywordtype">DIMENSION(1:2)</span>  :: zbounds
<a name="l00596"></a>00596 
<a name="l00597"></a>00597     <span class="comment">! ------------------------------------------------------------------</span>
<a name="l00598"></a>00598     <span class="comment">!!  Initializations</span>
<a name="l00599"></a>00599     <span class="comment">! ------------------------------------------------------------------</span>
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     CALL <a class="code" href="namespacef3dex__cosmotools.html#a609d3f29da9fc1be3bf27757e25532eb">txtfile2parameters</a>(paramfile,params)
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     handle = parse_init(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00604"></a>00604     convfc = params%convfc
<a name="l00605"></a>00605     almnoutfile = params%almnoutfile
<a name="l00606"></a>00606     clnoutfile = params%clnoutfile
<a name="l00607"></a>00607     nbptsasked = params%nbptsasked
<a name="l00608"></a>00608     multiscale = params%multiscale
<a name="l00609"></a>00609     nbptsinfile = nbptsasked
<a name="l00610"></a>00610     surveyfile = params%surveyfile
<a name="l00611"></a>00611     nr = params%nblayers
<a name="l00612"></a>00612     nbcolsinfile = params%nbcolsinfile
<a name="l00613"></a>00613     inradian = params%inradian
<a name="l00614"></a>00614     sorted = params%sorted
<a name="l00615"></a>00615     nside = params%nside
<a name="l00616"></a>00616     nnmax = params%nnmax
<a name="l00617"></a>00617     nlmax = params%nlmax
<a name="l00618"></a>00618     nmmax = params%nmmax
<a name="l00619"></a>00619     rmaxinput = params%rmaxinput
<a name="l00620"></a>00620     iter_order = params%iter_order
<a name="l00621"></a>00621     iwhere = params%iwhere
<a name="l00622"></a>00622     theta_cut_deg = params%theta_cut_deg
<a name="l00623"></a>00623     h = params%h
<a name="l00624"></a>00624     w0 = params%w0
<a name="l00625"></a>00625     wa = params%wa
<a name="l00626"></a>00626     omega_l = params%omega_l
<a name="l00627"></a>00627     omega_b = params%omega_b
<a name="l00628"></a>00628     omega_m = params%omega_m
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 
<a name="l00631"></a>00631     <span class="comment">! ------------------------------------------------------------------</span>
<a name="l00632"></a>00632     <span class="comment">!!  Ask for missing parameters</span>
<a name="l00633"></a>00633     <span class="comment">! ------------------------------------------------------------------</span>
<a name="l00634"></a>00634 
<a name="l00635"></a>00635     <span class="keyword">inquire</span>( file=surveyfile, exist=fileexists)
<a name="l00636"></a>00636     <span class="keyword">IF</span>( fileexists .eqv. .FALSE. ) <span class="keyword">THEN</span>
<a name="l00637"></a>00637        description = concatnl(<span class="stringliteral">&quot;Enter input file name (eg: data.out) : &quot;</span>)
<a name="l00638"></a>00638        surveyfile = parse_string(handle, <span class="stringliteral">&#39;surveyfile&#39;</span>, default=<span class="stringliteral">&#39;&#39;</span>, descr=description)
<a name="l00639"></a>00639        <span class="keyword">inquire</span>( file=surveyfile, exist=fileexists)
<a name="l00640"></a>00640        <span class="keyword">IF</span>( fileexists .eqv. .FALSE. ) CALL fatal_error(<span class="stringliteral">&quot;This file DOesn&#39;t exist!&quot;</span>)
<a name="l00641"></a>00641        <span class="keyword">IF</span> (trim(surveyfile)==<span class="stringliteral">&#39;&#39;</span>) CALL fatal_error(<span class="stringliteral">&#39;Error : no input file provided&#39;</span>)
<a name="l00642"></a>00642        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00643"></a>00643        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00644"></a>00644     <span class="keyword">ENDIF</span>
<a name="l00645"></a>00645     <span class="comment">!</span>
<a name="l00646"></a>00646     <span class="keyword">IF</span>( almnoutfile /= <span class="stringliteral">&quot;no&quot;</span> ) <span class="keyword">THEN</span>
<a name="l00647"></a>00647        almnoutfile = <span class="stringliteral">&quot;out/&quot;</span>//almnoutfile
<a name="l00648"></a>00648        <span class="keyword">inquire</span>( file=almnoutfile, exist=fileexists)
<a name="l00649"></a>00649        <span class="keyword">IF</span>( fileexists ) <span class="keyword">THEN</span>
<a name="l00650"></a>00650           PRINT*,<span class="stringliteral">&quot;Error : almn outputfile already exists ; please provide another name&quot;</span>
<a name="l00651"></a>00651           description = concatnl(<span class="stringliteral">&quot;Enter input file name (eg: almn.fits) : &quot;</span>)
<a name="l00652"></a>00652           almnoutfile = parse_string(handle, <span class="stringliteral">&#39;almnoutfile&#39;</span>, default=<span class="stringliteral">&#39;almn.fits&#39;</span>, descr=description)
<a name="l00653"></a>00653           almnoutfile = <span class="stringliteral">&quot;out/&quot;</span>//almnoutfile
<a name="l00654"></a>00654           <span class="keyword">inquire</span>( file=almnoutfile, exist=fileexists)
<a name="l00655"></a>00655           <span class="keyword">IF</span>( fileexists .eqv. .TRUE. ) CALL fatal_error(<span class="stringliteral">&quot;This file already exists!&quot;</span>)
<a name="l00656"></a>00656           PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00657"></a>00657        <span class="keyword">ENDIF</span>
<a name="l00658"></a>00658     <span class="keyword">ENDIF</span>
<a name="l00659"></a>00659     <span class="comment">!</span>
<a name="l00660"></a>00660     <span class="keyword">IF</span>( clnoutfile /= <span class="stringliteral">&quot;no&quot;</span> ) <span class="keyword">THEN</span>
<a name="l00661"></a>00661        clnoutfile = <span class="stringliteral">&quot;out/&quot;</span>//clnoutfile
<a name="l00662"></a>00662        <span class="keyword">inquire</span>( file=clnoutfile, exist=fileexists)
<a name="l00663"></a>00663        <span class="keyword">IF</span>( fileexists ) <span class="keyword">THEN</span>
<a name="l00664"></a>00664           PRINT*,<span class="stringliteral">&quot;Error : cln outputfile already exists ; please provide another name&quot;</span>
<a name="l00665"></a>00665           description = concatnl(<span class="stringliteral">&quot;Enter input file name (eg: cln.fits) : &quot;</span>)
<a name="l00666"></a>00666           clnoutfile = parse_string(handle, <span class="stringliteral">&#39;clnoutfile&#39;</span>, default=<span class="stringliteral">&#39;cln.fits&#39;</span>, descr=description)
<a name="l00667"></a>00667           clnoutfile = <span class="stringliteral">&quot;out/&quot;</span>//clnoutfile
<a name="l00668"></a>00668           <span class="keyword">inquire</span>( file=clnoutfile, exist=fileexists)
<a name="l00669"></a>00669           <span class="keyword">IF</span>( fileexists .eqv. .TRUE. ) CALL fatal_error(<span class="stringliteral">&quot;This file already exists!&quot;</span>)
<a name="l00670"></a>00670           PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00671"></a>00671        <span class="keyword">ENDIF</span>
<a name="l00672"></a>00672     <span class="keyword">ENDIF</span>
<a name="l00673"></a>00673     <span class="comment">!</span>
<a name="l00674"></a>00674     <span class="keyword">IF</span>( nbcolsinfile &lt; 0 ) <span class="keyword">THEN</span>
<a name="l00675"></a>00675        description = concatnl(<span class="stringliteral">&quot;How many columns DOes this file contain? (Necessary for parsing)&quot;</span>)
<a name="l00676"></a>00676        nbcolsinfile = parse_int(handle, <span class="stringliteral">&#39;nbcolsinfile&#39;</span>, default=-1, descr=description)
<a name="l00677"></a>00677        <span class="keyword">IF</span>( nbcolsinfile &lt; 0 .or. nbcolsinfile &gt; 20 ) CALL fatal_error(<span class="stringliteral">&quot;Error : Bad number.&quot;</span>)
<a name="l00678"></a>00678        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00679"></a>00679        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00680"></a>00680     <span class="keyword">ENDIF</span>
<a name="l00681"></a>00681     <span class="comment">!</span>
<a name="l00682"></a>00682     <span class="keyword">IF</span>( iwhere(1)&lt;1 .or. iwhere(1)&gt;nbcolsinfile ) <span class="keyword">THEN</span>
<a name="l00683"></a>00683        <span class="keyword">WRITE</span>(chline,<span class="stringliteral">&quot;(a)&quot;</span>) <span class="stringliteral">&quot;In which column is Coord 1 ?&quot;</span>   
<a name="l00684"></a>00684        description = concatnl( chline , <span class="stringliteral">&quot;&quot;</span> , chline1 )
<a name="l00685"></a>00685        iwhere(1) = parse_int(handle, <span class="stringliteral">&#39;Coord 1&#39;</span>, default=-1, descr=description)
<a name="l00686"></a>00686        <span class="keyword">IF</span>( iwhere(1)&lt;1 .or. iwhere(1)&gt;nbcolsinfile ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect column number&quot;</span>)
<a name="l00687"></a>00687        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00688"></a>00688        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00689"></a>00689     <span class="keyword">ENDIF</span>
<a name="l00690"></a>00690     <span class="comment">!</span>
<a name="l00691"></a>00691     <span class="keyword">IF</span>( iwhere(2)&lt;1 .or. iwhere(2)&gt;nbcolsinfile ) <span class="keyword">THEN</span>
<a name="l00692"></a>00692        <span class="keyword">WRITE</span>(chline,<span class="stringliteral">&quot;(a)&quot;</span>) <span class="stringliteral">&quot;In which column is Coord 2 ?&quot;</span>
<a name="l00693"></a>00693        description = concatnl( chline , <span class="stringliteral">&quot;&quot;</span> , chline1 )
<a name="l00694"></a>00694        iwhere(2) = parse_int(handle, <span class="stringliteral">&#39;Coord 2&#39;</span>, default=-1, descr=description)
<a name="l00695"></a>00695        <span class="keyword">IF</span>( iwhere(2)&lt;1 .or. iwhere(2)&gt;nbcolsinfile ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect column number&quot;</span>)
<a name="l00696"></a>00696        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00697"></a>00697        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00698"></a>00698     <span class="keyword">ENDIF</span>
<a name="l00699"></a>00699     <span class="comment">!</span>
<a name="l00700"></a>00700     <span class="keyword">IF</span>( iwhere(3)&lt;1 .or. iwhere(3)&gt;nbcolsinfile ) <span class="keyword">THEN</span>
<a name="l00701"></a>00701        <span class="keyword">WRITE</span>(chline,<span class="stringliteral">&quot;(a)&quot;</span>) <span class="stringliteral">&quot;In which column is Coord 3 ?&quot;</span>   
<a name="l00702"></a>00702        description = concatnl( chline , <span class="stringliteral">&quot;&quot;</span> , chline1 )
<a name="l00703"></a>00703        iwhere(3) = parse_int(handle, <span class="stringliteral">&#39;Coord 3&#39;</span>, default=-1, descr=description)
<a name="l00704"></a>00704        <span class="keyword">IF</span>( iwhere(3)&lt;1 .or. iwhere(3)&gt;nbcolsinfile ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect column number&quot;</span>)
<a name="l00705"></a>00705        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00706"></a>00706        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00707"></a>00707     <span class="keyword">ENDIF</span>
<a name="l00708"></a>00708     <span class="comment">!</span>
<a name="l00709"></a>00709     <span class="keyword">IF</span>( inradian &lt; 0 .or. inradian &gt; 1 ) <span class="keyword">THEN</span>
<a name="l00710"></a>00710        description = concatnl(<span class="stringliteral">&quot;Are your data in radian?&quot;</span> ,&amp;
<a name="l00711"></a>00711      &amp;<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;(0) No, in degree    (1) Yes, in radian&quot;</span>)
<a name="l00712"></a>00712        inradian = parse_int(handle, <span class="stringliteral">&#39;inradian&#39;</span>, default=0, descr=description)
<a name="l00713"></a>00713        <span class="keyword">IF</span>( inradian &lt; 0 .or. inradian &gt; 1 ) CALL fatal_error(<span class="stringliteral">&quot;Error : Bad number.&quot;</span>)
<a name="l00714"></a>00714        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00715"></a>00715        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00716"></a>00716     <span class="keyword">ENDIF</span>
<a name="l00717"></a>00717     <span class="comment">!</span>
<a name="l00718"></a>00718     <span class="keyword">IF</span>( sorted &lt; 0 .or. sorted &gt; 1 ) <span class="keyword">THEN</span>
<a name="l00719"></a>00719        description = concatnl(<span class="stringliteral">&quot;Is the array sorted by radial/redshIFt values? &quot;</span>,&amp;
<a name="l00720"></a>00720      &amp;<span class="stringliteral">&quot;(0) No, no sorted    (1) Yes, sorted&quot;</span>)
<a name="l00721"></a>00721        sorted = parse_int(handle, <span class="stringliteral">&#39;sorted&#39;</span>, default=0, descr=description)
<a name="l00722"></a>00722        <span class="keyword">IF</span>( sorted &lt; 0 .or. sorted &gt; 1 ) CALL fatal_error(<span class="stringliteral">&quot;Error : Bad number.&quot;</span>)
<a name="l00723"></a>00723        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00724"></a>00724        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00725"></a>00725     <span class="keyword">ENDIF</span>
<a name="l00726"></a>00726     <span class="comment">!</span>
<a name="l00727"></a>00727     <span class="keyword">IF</span>( nside &lt; 0 .or. nside &gt; 4096 ) <span class="keyword">THEN</span>
<a name="l00728"></a>00728        <span class="keyword">WRITE</span>(chline,<span class="stringliteral">&quot;(a)&quot;</span>) <span class="stringliteral">&quot;We recommEND: (256 &lt;= Nside &lt;= 2048) a power of 2&quot;</span>
<a name="l00729"></a>00729        description = concatnl(&amp;
<a name="l00730"></a>00730      &amp; <span class="stringliteral">&quot;Enter the Nside parameter (nsmax) for the healpix analysis. &quot;</span>, &amp;
<a name="l00731"></a>00731      &amp; chline )
<a name="l00732"></a>00732        nside = parse_int(handle, <span class="stringliteral">&#39;nside&#39;</span>, default=64, descr=description)
<a name="l00733"></a>00733        <span class="keyword">IF</span>( nside&lt;0 .or. nside&gt;1024 ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect boundaries (admitted : 4,8,16,64,128,256,512)&quot;</span>)
<a name="l00734"></a>00734        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00735"></a>00735        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00736"></a>00736     <span class="keyword">ENDIF</span>
<a name="l00737"></a>00737     <span class="comment">!</span>
<a name="l00738"></a>00738     <span class="keyword">IF</span>( nnmax &lt; 0 .or. nnmax &gt;= 250 ) <span class="keyword">THEN</span>
<a name="l00739"></a>00739        <span class="keyword">WRITE</span>(chline,<span class="stringliteral">&quot;(a)&quot;</span>) <span class="stringliteral">&quot;We recommEND: (1 &lt;= n &lt;= n_max &lt;= 250)&quot;</span>
<a name="l00740"></a>00740        description = concatnl(&amp;
<a name="l00741"></a>00741      &amp; <span class="stringliteral">&quot;Enter the maximum n range (n_max) for the analysis (Bessel FUNCTIONs). &quot;</span>, &amp;
<a name="l00742"></a>00742      &amp; chline )
<a name="l00743"></a>00743        nnmax = parse_int(handle, <span class="stringliteral">&#39;nnmax&#39;</span>, default=9, descr=description)
<a name="l00744"></a>00744        <span class="keyword">IF</span>( nnmax&lt;0 .or. nnmax&gt;500 ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect boundaries (admitted : [1,250])&quot;</span>)
<a name="l00745"></a>00745        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00746"></a>00746        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00747"></a>00747     <span class="keyword">ENDIF</span>
<a name="l00748"></a>00748     <span class="comment">!</span>
<a name="l00749"></a>00749     <span class="keyword">IF</span>( nlmax &lt; 0 .or. nlmax &gt; 256 ) <span class="keyword">THEN</span>
<a name="l00750"></a>00750        <span class="keyword">WRITE</span>(chline1,<span class="stringliteral">&quot;(a,i5)&quot;</span>) <span class="stringliteral">&quot;The map has Nside = &quot;</span>,nside
<a name="l00751"></a>00751        <span class="keyword">WRITE</span>(chline,<span class="stringliteral">&quot;(a,i5,a)&quot;</span>) <span class="stringliteral">&quot;We recommEND: (0 &lt;= l &lt;= l_max &lt;= &quot;</span>,200,<span class="stringliteral">&quot;)&quot;</span>
<a name="l00752"></a>00752        description = concatnl(&amp;
<a name="l00753"></a>00753      &amp; chline1, &amp;
<a name="l00754"></a>00754      &amp; <span class="stringliteral">&quot;Enter the maximum l range (l_max) for the analysis. &quot;</span>, &amp;
<a name="l00755"></a>00755      &amp; chline )
<a name="l00756"></a>00756        nlmax = parse_int(handle, <span class="stringliteral">&#39;nlmax&#39;</span>, default=2*nside, descr=description)
<a name="l00757"></a>00757        <span class="keyword">IF</span>( nlmax&lt;0 .or. nlmax&gt;4*nside ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect boundaries (admitted : [0,4*nside])&quot;</span>)
<a name="l00758"></a>00758        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00759"></a>00759        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00760"></a>00760     <span class="keyword">ENDIF</span>
<a name="l00761"></a>00761     <span class="comment">!</span>
<a name="l00762"></a>00762     <span class="keyword">IF</span>( nmmax &lt; 0 .or. nmmax &gt; 256 ) <span class="keyword">THEN</span>
<a name="l00763"></a>00763        <span class="keyword">WRITE</span>(chline,<span class="stringliteral">&quot;(a,i5,a)&quot;</span>) <span class="stringliteral">&quot;We recommEND: (0 &lt;= m &lt;= m_max &lt;= &quot;</span>,nlmax,<span class="stringliteral">&quot;)&quot;</span>
<a name="l00764"></a>00764        description = concatnl(&amp;
<a name="l00765"></a>00765      &amp; <span class="stringliteral">&quot; Enter the maximum m range (m_max) for the analysis. &quot;</span>, &amp;
<a name="l00766"></a>00766      &amp; chline )
<a name="l00767"></a>00767        nmmax = parse_int(handle, <span class="stringliteral">&#39;nmmax&#39;</span>, default=nlmax, descr=description)
<a name="l00768"></a>00768        <span class="keyword">IF</span>( nmmax&lt;0 .or. nmmax&gt;nlmax ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect boundaries (admitted : [1,nlmax])&quot;</span>)
<a name="l00769"></a>00769        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00770"></a>00770        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00771"></a>00771     <span class="keyword">ENDIF</span>
<a name="l00772"></a>00772     <span class="comment">!</span>
<a name="l00773"></a>00773     <span class="keyword">IF</span>( nr &lt; 4 ) <span class="keyword">THEN</span>
<a name="l00774"></a>00774        description = concatnl(&amp;
<a name="l00775"></a>00775      &amp; <span class="stringliteral">&quot; Enter the number of layers (radial discretization) &quot;</span> )
<a name="l00776"></a>00776        nr = parse_int(handle, <span class="stringliteral">&#39;nr&#39;</span>, default=8, descr=description)
<a name="l00777"></a>00777        <span class="keyword">IF</span>( nr&lt;4 ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect boundaries (admitted : [4,nlmax])&quot;</span>)
<a name="l00778"></a>00778        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00779"></a>00779        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00780"></a>00780     <span class="keyword">ENDIF</span>
<a name="l00781"></a>00781     <span class="comment">!</span>
<a name="l00782"></a>00782     <span class="keyword">IF</span>( h &lt; 0 ) <span class="keyword">THEN</span>
<a name="l00783"></a>00783        description = concatnl(&amp;
<a name="l00784"></a>00784      &amp; <span class="stringliteral">&quot; Cosmogoly - parameter : h &quot;</span> )
<a name="l00785"></a>00785        h = parse_DOuble(handle, <span class="stringliteral">&#39;h&#39;</span>, default=0.7_dp, descr=description)
<a name="l00786"></a>00786        <span class="keyword">IF</span>( h&lt;0 ) CALL fatal_error(<span class="stringliteral">&quot;Error&quot;</span>)
<a name="l00787"></a>00787        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00788"></a>00788        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00789"></a>00789     <span class="keyword">ENDIF</span>
<a name="l00790"></a>00790     <span class="comment">!</span>
<a name="l00791"></a>00791     <span class="keyword">IF</span>( omega_b &lt; 0 ) <span class="keyword">THEN</span>
<a name="l00792"></a>00792        description = concatnl(&amp;
<a name="l00793"></a>00793      &amp; <span class="stringliteral">&quot; Cosmogoly - parameter : omega_b &quot;</span> )
<a name="l00794"></a>00794        omega_b = parse_DOuble(handle, <span class="stringliteral">&#39;omega_b&#39;</span>, default=0.04_dp, descr=description)
<a name="l00795"></a>00795        <span class="keyword">IF</span>( omega_b&lt;0 ) CALL fatal_error(<span class="stringliteral">&quot;Error&quot;</span>)
<a name="l00796"></a>00796        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00797"></a>00797        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00798"></a>00798     <span class="keyword">ENDIF</span>
<a name="l00799"></a>00799     <span class="comment">!</span>
<a name="l00800"></a>00800     <span class="keyword">IF</span>( omega_m &lt; 0 ) <span class="keyword">THEN</span>
<a name="l00801"></a>00801        description = concatnl(&amp;
<a name="l00802"></a>00802      &amp; <span class="stringliteral">&quot; Cosmogoly - parameter : omega_m &quot;</span> )
<a name="l00803"></a>00803        omega_m = parse_DOuble(handle, <span class="stringliteral">&#39;omega_m&#39;</span>, default=0.3_dp, descr=description)
<a name="l00804"></a>00804        <span class="keyword">IF</span>( omega_m&lt;0 ) CALL fatal_error(<span class="stringliteral">&quot;Error&quot;</span>)
<a name="l00805"></a>00805        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00806"></a>00806        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00807"></a>00807     <span class="keyword">ENDIF</span>
<a name="l00808"></a>00808     <span class="comment">!</span>
<a name="l00809"></a>00809     <span class="keyword">IF</span>( omega_l &lt; 0 ) <span class="keyword">THEN</span>
<a name="l00810"></a>00810        description = concatnl(&amp;
<a name="l00811"></a>00811      &amp; <span class="stringliteral">&quot; Cosmogoly - parameter : omega_l &quot;</span> )
<a name="l00812"></a>00812        omega_l = parse_DOuble(handle, <span class="stringliteral">&#39;omega_l&#39;</span>, default=0.7_dp, descr=description)
<a name="l00813"></a>00813        <span class="keyword">IF</span>( omega_l&lt;0 ) CALL fatal_error(<span class="stringliteral">&quot;Error&quot;</span>)
<a name="l00814"></a>00814        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00815"></a>00815        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00816"></a>00816     <span class="keyword">ENDIF</span>
<a name="l00817"></a>00817     <span class="comment">!</span>
<a name="l00818"></a>00818     <span class="keyword">IF</span>( wa &lt; -5 ) <span class="keyword">THEN</span>
<a name="l00819"></a>00819        description = concatnl(&amp;
<a name="l00820"></a>00820      &amp; <span class="stringliteral">&quot; Cosmogoly - parameter : wa &quot;</span> )
<a name="l00821"></a>00821        wa = parse_DOuble(handle, <span class="stringliteral">&#39;wa&#39;</span>, default=0.0_dp, descr=description)
<a name="l00822"></a>00822        <span class="keyword">IF</span>( wa&lt;-5 ) CALL fatal_error(<span class="stringliteral">&quot;Error&quot;</span>)
<a name="l00823"></a>00823        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00824"></a>00824        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00825"></a>00825     <span class="keyword">ENDIF</span>
<a name="l00826"></a>00826     <span class="comment">!</span>
<a name="l00827"></a>00827     <span class="keyword">IF</span>( w0 &lt; -5 ) <span class="keyword">THEN</span>
<a name="l00828"></a>00828        description = concatnl(&amp;
<a name="l00829"></a>00829      &amp; <span class="stringliteral">&quot; Cosmogoly - parameter : w0 &quot;</span> )
<a name="l00830"></a>00830        w0 = parse_DOuble(handle, <span class="stringliteral">&#39;w0&#39;</span>, default=-1.0_dp, descr=description)
<a name="l00831"></a>00831        <span class="keyword">IF</span>( w0&lt;-5 ) CALL fatal_error(<span class="stringliteral">&quot;Error&quot;</span>)
<a name="l00832"></a>00832        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00833"></a>00833        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00834"></a>00834     <span class="keyword">ENDIF</span>
<a name="l00835"></a>00835     <span class="comment">!</span>
<a name="l00836"></a>00836     <span class="keyword">IF</span>( multiscale &lt; 0 .or. multiscale &gt; 4 ) <span class="keyword">THEN</span>
<a name="l00837"></a>00837        description = concatnl(&amp;
<a name="l00838"></a>00838      &amp; <span class="stringliteral">&quot; Enter the number of layers (radial discretization) &quot;</span> )
<a name="l00839"></a>00839        multiscale = parse_int(handle, <span class="stringliteral">&#39;multiscalenr&#39;</span>, default=1, descr=description)
<a name="l00840"></a>00840        <span class="keyword">IF</span>( multiscale&lt;0 .or. multiscale &gt; 4 ) CALL fatal_error(<span class="stringliteral">&quot;Incorrect boundaries (admitted : [1,3])&quot;</span>)
<a name="l00841"></a>00841        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00842"></a>00842        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00843"></a>00843     <span class="keyword">ENDIF</span>
<a name="l00844"></a>00844     <span class="comment">!</span>
<a name="l00845"></a>00845     <span class="keyword">IF</span>( rmaxinput &lt; 0 ) <span class="keyword">THEN</span>
<a name="l00846"></a>00846        description = concatnl(&amp;
<a name="l00847"></a>00847      &amp; <span class="stringliteral">&quot; Maximal radial value - rmax &quot;</span> )
<a name="l00848"></a>00848        rmaxinput = parse_DOuble(handle, <span class="stringliteral">&#39;rmaxinput&#39;</span>, default=-1.0_dp, descr=description)
<a name="l00849"></a>00849        <span class="keyword">IF</span>( rmaxinput&lt;0 ) CALL fatal_error(<span class="stringliteral">&quot;Error&quot;</span>)
<a name="l00850"></a>00850        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00851"></a>00851        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00852"></a>00852     <span class="keyword">ENDIF</span>
<a name="l00853"></a>00853     <span class="comment">!</span>
<a name="l00854"></a>00854     <span class="keyword">IF</span>( iter_order &lt; 0 .or. iter_order &gt; 10 ) <span class="keyword">THEN</span>
<a name="l00855"></a>00855        description = concatnl(&amp;
<a name="l00856"></a>00856      &amp; <span class="stringliteral">&quot; Do you want : &quot;</span>, &amp;
<a name="l00857"></a>00857      &amp; <span class="stringliteral">&quot; 0) a standard analysis&quot;</span>, &amp;
<a name="l00858"></a>00858      &amp; <span class="stringliteral">&quot; 1,2,3,4....) an iterative analysis&quot;</span>, &amp;
<a name="l00859"></a>00859      &amp; <span class="stringliteral">&quot; (enter order of iteration, 3rd order is usually optimal)&quot;</span>)
<a name="l00860"></a>00860        iter_order=parse_int(handle, <span class="stringliteral">&#39;iter_order&#39;</span>, vmin=0, default=0, descr=description)
<a name="l00861"></a>00861        <span class="keyword">select</span> <span class="keyword">case</span> (iter_order)
<a name="l00862"></a>00862        <span class="keyword">case</span> (0)
<a name="l00863"></a>00863           PRINT*,<span class="stringliteral">&quot; Standard analysis&quot;</span>
<a name="l00864"></a>00864        <span class="keyword">case</span> default
<a name="l00865"></a>00865           PRINT*,<span class="stringliteral">&quot; Iterative analysis&quot;</span>
<a name="l00866"></a>00866        <span class="keyword">END select</span>
<a name="l00867"></a>00867        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00868"></a>00868        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00869"></a>00869     <span class="keyword">ENDIF</span>
<a name="l00870"></a>00870     <span class="comment">!</span>
<a name="l00871"></a>00871     <span class="keyword">IF</span>( theta_cut_deg &lt; 0.0 .or. theta_cut_deg &gt; 1.0 ) <span class="keyword">THEN</span>
<a name="l00872"></a>00872        description = concatnl(&amp;
<a name="l00873"></a>00873      &amp; <span class="stringliteral">&quot; Enter the symmetric cut around the equator in DEGREES : &quot;</span>, &amp;
<a name="l00874"></a>00874      &amp; <span class="stringliteral">&quot; (One ignores data within |b| &lt; b_cut)     0 &lt;= b_cut = &quot;</span>)
<a name="l00875"></a>00875        theta_cut_deg = parse_DOuble(handle, <span class="stringliteral">&#39;theta_cut_deg&#39;</span>, &amp;
<a name="l00876"></a>00876      &amp;                       vmin=0.0_dp, default=0.0_dp, descr=description)
<a name="l00877"></a>00877        cos_theta_cut = SIN(theta_cut_deg/180.d0*PI) <span class="comment">!counted from equator instead of from pole</span>
<a name="l00878"></a>00878        zbounds = (/ cos_theta_cut , -cos_theta_cut /)
<a name="l00879"></a>00879        <span class="keyword">IF</span> (theta_cut_deg&lt;1e-4) zbounds = (/ -1.0_dp, 1.0_dp /) <span class="comment">!keep all sphere IF cut not set</span>
<a name="l00880"></a>00880        fsky = (zbounds(2)-zbounds(1))/2.0_dp
<a name="l00881"></a>00881        <span class="keyword">IF</span> (fsky &lt;= 0.0_dp) fsky = 1.0_dp + fsky
<a name="l00882"></a>00882        <span class="keyword">write</span>(*,<span class="stringliteral">&quot;(a,f6.1,a)&quot;</span>) <span class="stringliteral">&quot;One keeps &quot;</span>,100.*fsky,<span class="stringliteral">&quot; % of the original map(s)&quot;</span>   
<a name="l00883"></a>00883        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00884"></a>00884        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00885"></a>00885     <span class="keyword">ENDIF</span>
<a name="l00886"></a>00886     <span class="comment">!</span>
<a name="l00887"></a>00887     <span class="keyword">IF</span>( nbptsasked &lt;= 0 ) <span class="keyword">THEN</span>
<a name="l00888"></a>00888        description = concatnl(<span class="stringliteral">&quot;How many galaxies DO you want to take into account?&quot;</span>)
<a name="l00889"></a>00889        nbptsasked = parse_int(handle, <span class="stringliteral">&#39;nbptsasked&#39;</span>, default=-1, descr=description)
<a name="l00890"></a>00890        <span class="keyword">IF</span>( nbptsasked &lt;= 0 ) CALL fatal_error(<span class="stringliteral">&quot;Error : Bad number.&quot;</span>)
<a name="l00891"></a>00891        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00892"></a>00892        PRINT*,<span class="stringliteral">&quot; &quot;</span>
<a name="l00893"></a>00893     <span class="keyword">ENDIF</span>
<a name="l00894"></a>00894 
<a name="l00895"></a>00895     PRINT*,<span class="stringliteral">&quot;-----------------------------------&quot;</span>
<a name="l00896"></a>00896     PRINT*,<span class="stringliteral">&quot;Starting extraction from file&quot;</span>
<a name="l00897"></a>00897     PRINT*,<span class="stringliteral">&quot;-----------------------------------&quot;</span>
<a name="l00898"></a>00898     PRINT*,<span class="stringliteral">&quot;&quot;</span>
<a name="l00899"></a>00899     PRINT*,<span class="stringliteral">&quot;File to be read : &quot;</span>,surveyfile(1:10)
<a name="l00900"></a>00900     <span class="keyword">inquire</span>( file=surveyfile, exist=fileexists)
<a name="l00901"></a>00901     <span class="keyword">IF</span>( fileexists ) <span class="keyword">THEN</span>
<a name="l00902"></a>00902        PRINT*,<span class="stringliteral">&quot;Checking file ... ok existing.&quot;</span>
<a name="l00903"></a>00903     <span class="keyword">ELSE</span>
<a name="l00904"></a>00904        CALL fatal_error(<span class="stringliteral">&quot;Error: unknown file&quot;</span>)
<a name="l00905"></a>00905     <span class="keyword">ENDIF</span>
<a name="l00906"></a>00906     <span class="keyword">open</span>(2,file= surveyfile, status=<span class="stringliteral">&#39;old&#39;</span>, iostat=rdstatus, form=<span class="stringliteral">&quot;formatted&quot;</span>)
<a name="l00907"></a>00907     PRINT*,<span class="stringliteral">&quot;Opening file status: &quot;</span>,rdstatus
<a name="l00908"></a>00908     nbptsinfile = 0
<a name="l00909"></a>00909     <span class="keyword">DO</span> <span class="keyword">while</span>(rdstatus == 0)  
<a name="l00910"></a>00910        <span class="keyword">read</span>(2,*,iostat = rdstatus) 
<a name="l00911"></a>00911        <span class="keyword">IF</span> (rdstatus == 0) <span class="keyword">THEN</span>
<a name="l00912"></a>00912           nbptsinfile = nbptsinfile + 1
<a name="l00913"></a>00913        <span class="keyword">ENDIF</span>
<a name="l00914"></a>00914     <span class="keyword">END DO</span>
<a name="l00915"></a>00915     PRINT*,<span class="stringliteral">&quot;Number of points read : &quot;</span>, nbptsinfile
<a name="l00916"></a>00916     nbpts = min(nbptsasked,nbptsinfile)
<a name="l00917"></a>00917     PRINT*,<span class="stringliteral">&quot;Final number of galaxies to be analyzed : &quot;</span>,nbpts
<a name="l00918"></a>00918     <span class="keyword">close</span>(2)
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 <span class="keyword">  END SUBROUTINE getParameters_survey2almn</span>
<a name="l00921"></a>00921 
<a name="l00922"></a>00922   <span class="comment">! ---------------------------------------------------------------------------------------!    </span>
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 
<a name="l00926"></a><a class="code" href="namespacef3dex__cosmotools.html#aaef3c07f112a83e6ff7a2762d5202fae">00926</a>   <span class="keyword">SUBROUTINE </span><a class="code" href="namespacef3dex__cosmotools.html#aaef3c07f112a83e6ff7a2762d5202fae">extractFromFile</a>( nbpts, nr, iwhere, inradian, sorted, convfc, nbcolsinfile, surveyfile, survey )
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="keyword">IMPLICIT NONE</span>
<a name="l00929"></a>00929 
<a name="l00930"></a>00930     <span class="comment">! ------------------------------------------------------------------------------</span>
<a name="l00931"></a>00931     <span class="comment">! Extract data from input file and convert it into valid healpix 3D maps</span>
<a name="l00932"></a>00932     <span class="comment">! ------------------------------------------------------------------------------</span>
<a name="l00933"></a>00933 
<a name="l00934"></a>00934     <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">PARAMETER</span>    :: code = <span class="stringliteral">&quot;Survey extraction&quot;</span>
<a name="l00935"></a>00935     <span class="keywordtype">character(len=FILENAMELEN)</span>     :: surveyfile
<a name="l00936"></a>00936     <span class="keywordtype">INTEGER</span>(I4B)      :: nbcolsinfile, status, nbpts, k, sorted
<a name="l00937"></a>00937     <span class="keywordtype">INTEGER</span>(I4B)      :: i, inradian, rdstatus, nsmax, nr
<a name="l00938"></a>00938     <span class="keywordtype">REAL(kind=DP)</span>, <span class="keywordtype">DIMENSION(1:nbpts)</span>       :: mapcop
<a name="l00939"></a>00939     <span class="keywordtype">REAL(kind=DP)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">allocatable</span>:: temp
<a name="l00940"></a>00940     <span class="keywordtype">REAL(kind=DP)</span>, <span class="keywordtype">DIMENSION(1:nbpts,1:3)</span>   :: survey, surveybis
<a name="l00941"></a>00941     <span class="keywordtype">INTEGER(i4b)</span>,  <span class="keywordtype">DIMENSION(1:3)</span>           :: iwhere
<a name="l00942"></a>00942     <span class="keywordtype">REAL(DP)</span> :: convfc
<a name="l00943"></a>00943 
<a name="l00944"></a>00944     <span class="keyword">ALLOCATE</span>(temp(1:nbcolsinfile),stat = status)
<a name="l00945"></a>00945     CALL assert_alloc(status,code,<span class="stringliteral">&quot;temp&quot;</span>)
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     survey = 0.0
<a name="l00948"></a>00948     surveybis = 0.0
<a name="l00949"></a>00949     <span class="keyword">open</span>(2,file= trim(surveyfile), status=<span class="stringliteral">&#39;old&#39;</span>, iostat=rdstatus, form=<span class="stringliteral">&quot;formatted&quot;</span>)
<a name="l00950"></a>00950     rewind(unit=2,iostat=rdstatus)
<a name="l00951"></a>00951     PRINT*,<span class="stringliteral">&quot;&quot;</span>
<a name="l00952"></a>00952     PRINT*,<span class="stringliteral">&quot;Extraction...&quot;</span>
<a name="l00953"></a>00953     <span class="keyword">DO</span> <span class="keyword">while</span>(rdstatus == 0)
<a name="l00954"></a>00954        <span class="keyword">DO</span> i=1, nbpts
<a name="l00955"></a>00955           <span class="keyword">READ</span> (2,*,iostat = rdstatus, END=61) (temp(k),k=1,nbcolsinfile) 
<a name="l00956"></a>00956           surveybis(i,1) = temp(iwhere(1))
<a name="l00957"></a>00957           surveybis(i,2) = temp(iwhere(2))
<a name="l00958"></a>00958           surveybis(i,3) = temp(iwhere(3))
<a name="l00959"></a>00959        <span class="keyword">ENDDO</span>
<a name="l00960"></a>00960     <span class="keyword">ENDDO</span>
<a name="l00961"></a>00961 61  continue
<a name="l00962"></a>00962     PRINT*,<span class="stringliteral">&quot;-- DOne&quot;</span>
<a name="l00963"></a>00963     <span class="keyword">close</span>(2)
<a name="l00964"></a>00964     <span class="keyword">deALLOCATE</span>(temp)
<a name="l00965"></a>00965 
<a name="l00966"></a>00966     <span class="comment">! Convertion from degree to radian IF necessary</span>
<a name="l00967"></a>00967     <span class="keyword">IF</span>( inradian == 0 ) <span class="keyword">THEN</span>
<a name="l00968"></a>00968        PRINT*,<span class="stringliteral">&quot;&quot;</span>
<a name="l00969"></a>00969        PRINT*,<span class="stringliteral">&quot;Convertion from degree to radian...&quot;</span>
<a name="l00970"></a>00970        <span class="keyword">DO</span> i=1,nbpts
<a name="l00971"></a>00971           surveybis(i,1) = surveybis(i,1)*PI/180
<a name="l00972"></a>00972           surveybis(i,2) = surveybis(i,2)*PI/180 
<a name="l00973"></a>00973           surveybis(i,2) = HALFPI - surveybis(i,2)            <span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<a name="l00974"></a>00974        <span class="keyword">ENDDO</span>
<a name="l00975"></a>00975        PRINT*,<span class="stringliteral">&quot;-- DOne&quot;</span>
<a name="l00976"></a>00976     <span class="keyword">ENDIF</span>
<a name="l00977"></a>00977 
<a name="l00978"></a>00978     <span class="comment">! ------------------------------------------------------------------</span>
<a name="l00979"></a>00979     <span class="comment">!!  Sorting the survey</span>
<a name="l00980"></a>00980     <span class="comment">! ------------------------------------------------------------------ </span>
<a name="l00981"></a>00981 
<a name="l00982"></a>00982     <span class="keyword">IF</span>( sorted == 0 ) <span class="keyword">THEN</span>
<a name="l00983"></a>00983        PRINT*,<span class="stringliteral">&quot;Sorting values.&quot;</span>
<a name="l00984"></a>00984        mapcop(1:nbpts) = surveybis(1:nbpts,3)
<a name="l00985"></a>00985        CALL <a class="code" href="namespacef3dex__utils.html#a2cce76cb1a695da8315cbf60507ec322">BSORT </a>(mapcop, surveybis, nbpts)
<a name="l00986"></a>00986        <span class="keyword">DO</span> i = 1, nbpts
<a name="l00987"></a>00987           survey(i,1:3) = surveybis(nbpts-i+1,1:3)
<a name="l00988"></a>00988           survey(i,3) = survey(i,3) / convfc
<a name="l00989"></a>00989        <span class="keyword">ENDDO</span>
<a name="l00990"></a>00990     <span class="keyword">ELSE</span>
<a name="l00991"></a>00991        survey = surveybis
<a name="l00992"></a>00992        survey(:,3) = survey(:,3) / convfc
<a name="l00993"></a>00993     <span class="keyword">ENDIF</span>
<a name="l00994"></a>00994 
<a name="l00995"></a>00995     RETURN
<a name="l00996"></a>00996 
<a name="l00997"></a>00997 <span class="keyword">  END SUBROUTINE extractFromFile</span>
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   <span class="comment">! ---------------------------------------------------------------------------------------!    </span>
<a name="l01000"></a>01000 
<a name="l01001"></a>01001 <span class="keyword">END MODULE f3dex_cosmotools</span>
</pre></div></div>
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 16 2011 01:39:45 for 3DEX by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
